(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[5778],{77921:function(Rt,ae,n){"use strict";n.r(ae),n.d(ae,{default:function(){return We}});var St=n(71194),se=n(50146),Ct=n(20228),Se=n(11382),jt=n(58024),Ce=n(91894),It=n(66456),je=n(15711),Ft=n(62350),Ie=n(24565),wt=n(48736),re=n(27049),Dt=n(402),Fe=n(56256),Et=n(57663),b=n(71577),Tt=n(47673),k=n(4107),we=n(93224),B=n(11849),Bt=n(34792),y=n(48086),c=n(2824),Pt=n(7359),De=n(27279),At=n(9715),j=n(55843),d=n(67294),Ee=n(30381),le=n.n(Ee),h=n(39428),R=n(3182),g=n(21010);function L(i){return H.apply(this,arguments)}function H(){return H=(0,R.Z)((0,h.Z)().mark(function i(u){return(0,h.Z)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,g.WY)("/phm-web-service-gz/role/show",{method:"POST",data:u}));case 1:case"end":return a.stop()}},i)})),H.apply(this,arguments)}function Te(i){return V.apply(this,arguments)}function V(){return V=(0,R.Z)((0,h.Z)().mark(function i(u){return(0,h.Z)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,g.WY)("/phm-web-service-gz/sys/role/delete/".concat(u),{method:"POST"}));case 1:case"end":return a.stop()}},i)})),V.apply(this,arguments)}function Be(i){return G.apply(this,arguments)}function G(){return G=(0,R.Z)((0,h.Z)().mark(function i(u){return(0,h.Z)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,g.WY)("/phm-web-service-gz/sys/role/add",{method:"POST",data:u}));case 1:case"end":return a.stop()}},i)})),G.apply(this,arguments)}function Pe(i){return U.apply(this,arguments)}function U(){return U=(0,R.Z)((0,h.Z)().mark(function i(u){return(0,h.Z)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,g.WY)("/phm-web-service-gz/sys/role/update",{method:"POST",data:u}));case 1:case"end":return a.stop()}},i)})),U.apply(this,arguments)}function Ae(){return J.apply(this,arguments)}function J(){return J=(0,R.Z)((0,h.Z)().mark(function i(){return(0,h.Z)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,g.WY)("/phm-web-service-gz/sys/role/queryTreeList",{}));case 1:case"end":return o.stop()}},i)})),J.apply(this,arguments)}function ie(i){return Q.apply(this,arguments)}function Q(){return Q=(0,R.Z)((0,h.Z)().mark(function i(u){return(0,h.Z)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,g.WY)("/phm-web-service-gz/sys/permission/queryRolePermission/".concat(u),{method:"GET"}));case 1:case"end":return a.stop()}},i)})),Q.apply(this,arguments)}function Oe(i){return X.apply(this,arguments)}function X(){return X=(0,R.Z)((0,h.Z)().mark(function i(u){return(0,h.Z)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,g.WY)("/phm-web-service-gz/sys/permission/saveRolePermission",{method:"POST",data:u}));case 1:case"end":return a.stop()}},i)})),X.apply(this,arguments)}var $e=n(51042),Ot=n(63185),Ye=n(9676),t=n(85893),ke=function i(u){var o=u.allRoutes,a=o===void 0?[]:o,_=u.num,l=u.newRouteIds,S=u.handleNewRoutes,I=(0,d.useState)(u.newRouteIds),M=(0,c.Z)(I,2),C=M[0],F=M[1];console.log("allRoutes"),console.log(a);var P=(0,d.useState)(!1),N=(0,c.Z)(P,2),A=N[0],x=N[1];(0,d.useEffect)(function(){A&&setTimeout(function(){return x(!1)})},[A]);var O=function(w,p){var m=w.target.value,$=w.target.checked;if(p.children)if($)l.includes(p.key)||l.push(p.key),p.children.map(function(E){l.includes(E.key)||l.push(E.key)}),S(l),F(l),x(!0);else{var z=l.indexOf(p.key);z!=-1&&l.splice(z,1),p.children.map(function(E){var W=l.indexOf(E.key);W!=-1&&l.splice(W,1)}),S(l),F(l),x(!0)}else if(!l.includes(m)&&$)l.includes(m)||l.push(m),S(l),F(l),x(!0);else if(l.includes(m)&&!$){var D=l.indexOf(m);D!=-1&&l.splice(D,1),S(l),F(l),x(!0)}};return(0,t.jsx)("div",{style:{marginLeft:_},children:C&&a.map(function(v,w){return console.log(v),console.log(C.includes(v.key)),(0,t.jsxs)("div",{children:[(0,t.jsx)(Ye.Z,{onChange:function(m){return O(m,v)},value:v.key,checked:C.includes(v.key),children:v.slotTitle}),v.children?(0,t.jsx)(i,{allRoutes:v.children,num:10,newRouteIds:C,handleNewRoutes:S}):null]})})})},Le=ke,Me=n(61128),Ne=["editing","dataIndex","title","inputType","record","index","children"],q=j.Z.Item,$t=De.Z.Panel,ze=function(){var u=(0,g.tT)("@@initialState"),o=u.initialState,a=u.setInitialState,_=(0,d.useState)([]),l=(0,c.Z)(_,2),S=l[0],I=l[1],M=(0,d.useState)(!1),C=(0,c.Z)(M,2),F=C[0],P=C[1],N=(0,d.useState)(!1),A=(0,c.Z)(N,2),x=A[0],O=A[1],v=(0,d.useState)(""),w=(0,c.Z)(v,2),p=w[0],m=w[1],$=j.Z.useForm(),z=(0,c.Z)($,1),D=z[0],E=j.Z.useForm(),W=(0,c.Z)(E,1),ue=W[0],Ke=(0,d.useState)({}),oe=(0,c.Z)(Ke,2),Yt=oe[0],kt=oe[1],be=(0,d.useState)([]),de=(0,c.Z)(be,2),He=de[0],Ve=de[1],Ge=(0,d.useState)([]),ce=(0,c.Z)(Ge,2),Ue=ce[0],Je=ce[1],Qe=(0,d.useState)(["first"]),he=(0,c.Z)(Qe,2),fe=he[0],ee=he[1],Xe=(0,d.useState)(""),ve=(0,c.Z)(Xe,2),te=ve[0],me=ve[1],qe=(0,d.useState)(["first"]),pe=(0,c.Z)(qe,2),ne=pe[0],K=pe[1],_e=(0,d.useState)(!1),ye=(0,c.Z)(_e,2),et=ye[0],ge=ye[1],tt=(0,d.useState)(""),xe=(0,c.Z)(tt,2),nt=xe[0],at=xe[1],st=function(e){Te(e).then(function(s){s.status===200?(y.default.success("\u5220\u9664\u89D2\u8272\u6210\u529F"),L({}).then(function(f){I(f.data)}).catch(function(f){y.default.error("\u8BF7\u6C42\u5931\u8D25\uFF01")})):y.default.error("\u5220\u9664\u89D2\u8272\u5931\u8D25,\u8BF7\u91CD\u8BD5")})},rt=function(e){ue.setFieldsValue((0,B.Z)({name:"",desc:"",id:"",code:"",createBy:"",updateBy:""},e)),console.log(e),at(e.creator),m(e.id),me(e.id)},lt=function(){m("")},Ze=function(e){return e.id===p},it=function(e){var s=e.editing,f=e.dataIndex,Z=e.title,Y=e.inputType,Re=e.record,T=Re===void 0?{}:Re,Mt=e.index,gt=e.children,xt=(0,we.Z)(e,Ne),Zt=(0,t.jsx)(k.Z,{initialvalues:T==null?void 0:T[f]});return(0,t.jsx)("td",(0,B.Z)((0,B.Z)({},xt),{},{children:s?(0,t.jsx)(j.Z.Item,{name:f,style:{margin:0},initialValue:T==null?void 0:T[f],children:Zt}):gt}))},ut=[{title:"\u521B\u5EFA\u4EBA",dataIndex:"createBy",key:"createBy",align:"center"},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createAt",key:"createAt",align:"center",render:function(e,s){return s.createAt?(0,t.jsx)("span",{children:le()(s.createAt).format("YYYY-MM-DD HH:mm")}):"--"}},{title:"\u63CF\u8FF0",dataIndex:"description",key:"desc",editable:!0,width:200,align:"center"},{title:"ID",dataIndex:"id",key:"id",align:"center",editable:!1},{title:"\u89D2\u8272\u7F16\u7801",dataIndex:"roleCode",key:"code",editable:!0,width:80,align:"center"},{title:"\u89D2\u8272\u540D\u79F0",dataIndex:"roleName",key:"name",editable:!0,width:120,align:"center"},{title:"\u66F4\u65B0\u4EBA",dataIndex:"updateBy",key:"updateBy",align:"center"},{title:"\u66F4\u65B0\u65E5\u671F",dataIndex:"updateAt",key:"updateTime",align:"center",render:function(e,s){return s.updateAt?(0,t.jsx)("span",{children:le()(s.updateAt).format("YYYY-MM-DD HH:mm")}):"--"}},{title:"\u64CD\u4F5C",key:"action",width:"15%",align:"center",render:function(e,s){var f=Ze(s);return(0,t.jsxs)(t.Fragment,{children:[f?(0,t.jsxs)("div",{style:{display:"flex"},children:[(0,t.jsx)(b.Z,{type:"primary",htmlType:"submit",children:"\u4FDD\u5B58"}),(0,t.jsx)(b.Z,{type:"primary",style:{marginLeft:10},onClick:lt,children:"\u53D6\u6D88"})]}):(0,t.jsx)(Fe.Z.Link,{disabled:p!=="",onClick:function(){return rt(s)},style:{color:"#066aff"},children:"\u7F16\u8F91"}),(0,t.jsx)(re.Z,{type:"vertical"}),(0,t.jsx)("a",{children:(0,t.jsx)(Ie.Z,{title:"\u786E\u8BA4\u5220\u9664?",onConfirm:function(){return st(s.id)},children:(0,t.jsx)("span",{style:{cursor:"pointer"},children:"\u5220\u9664"})})}),(0,t.jsx)(re.Z,{type:"vertical"}),(0,t.jsx)("a",{onClick:function(){me(s.id),O(!0),ie(s.id).then(function(Y){console.log(Y),console.log(Y.data.menuIds),ee(Y.data.menuIds),K(Y.data.menuIds)})},children:"\u914D\u7F6E\u8DEF\u7531"}),(0,t.jsx)("span",{})]})}}];(0,d.useEffect)(function(){L({}).then(function(r){r.data.map(function(e,s){e.key=s}),I(r.data)})},[1]),(0,d.useEffect)(function(){Ae().then(function(r){var e;Je((e=r.data)===null||e===void 0?void 0:e.treeList)})},[1]);var ot=function(){P(!0)},dt=function(){P(!1)},ct=function(){O(!1),ee(["first"]),console.log("2222"),K(["first"])},ht=function(){var e,s=D.getFieldsValue();s.createBy=o==null||(e=o.currentUser)===null||e===void 0?void 0:e.name,console.log(s),Be(s).then(function(f){f.status===200?(y.default.success("\u65B0\u589E\u89D2\u8272\u6210\u529F"),P(!1),D.resetFields(),L({}).then(function(Z){I(Z.data)})):y.default.error("\u65B0\u589E\u89D2\u8272\u5931\u8D25,\u8BF7\u91CD\u8BD5")})},ft=function(){console.log("handleOk2"),O(!1),ge(!0),ie(te).then(function(e){console.log("queryRolePermission data"),console.log(e),Oe({roleId:te,permissionIds:ne,lastpermissionIds:e.data.menuIds}).then(function(s){console.log(s),s.success?(console.log(s.success),ee(["first"]),console.log("3333"),K(["first"]),ge(!1),y.default.success("\u914D\u7F6E\u8DEF\u7531\u6210\u529F")):y.default.error("\u914D\u7F6E\u8DEF\u7531\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")})})},vt=ut.map(function(r){return r.editable?(0,B.Z)((0,B.Z)({},r),{},{onCell:function(s){return{record:s,inputType:"text",dataIndex:r.dataIndex,title:r.title,editing:Ze(s)}}}):r}),mt=function(e){var s;e.id=te,e.updateBy=o==null||(s=o.currentUser)===null||s===void 0?void 0:s.name,e.createBy=nt,console.log("============>",e),Pe(e).then(function(f){f.status===200?(y.default.success("\u4FEE\u6539\u6210\u529F"),m(""),L({}).then(function(Z){I(Z.data)})):y.default.error("\u4FEE\u6539\u5931\u8D25,\u8BF7\u91CD\u8BD5")})},Lt=function(e,s,f,Z){return(0,t.jsx)("div",{children:"waiting"})},pt=function(e){Ve(e)},yt=function(e){console.log(44444),K(e)};return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(Me.ZP,{children:[(0,t.jsx)(Ce.Z,{extra:(0,t.jsxs)(b.Z,{onClick:ot,type:"primary",children:[(0,t.jsx)($e.Z,{}),"\u65B0\u589E\u89D2\u8272"]}),children:(0,t.jsx)(j.Z,{form:ue,name:"editRole",onFinish:mt,children:(0,t.jsx)(je.Z,{components:{body:{cell:it}},toolBarRender:function(){return[,]},columns:vt,dataSource:S,bordered:!0,size:"middle",pagination:{pageSize:10},expandedRowKeys:He,onExpandedRowsChange:pt,rowKey:function(e){return e.id}})})}),et&&(0,t.jsx)("div",{style:{position:"fixed",top:"50%",left:"50%"},children:(0,t.jsx)(Se.Z,{tip:"\u66F4\u65B0\u914D\u7F6E\u4E2D.......",size:"large"})}),(0,t.jsx)(se.Z,{title:"\u65B0\u589E\u89D2\u8272",open:F,onOk:ht,onCancel:dt,centered:!0,children:(0,t.jsxs)(j.Z,{form:D,children:[(0,t.jsx)(q,{labelCol:{span:5},wrapperCol:{span:15},label:"\u89D2\u8272\u7F16\u7801",name:"roleCode",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u81F3\u5C11\u4E24\u4E2A\u5B57\u7B26\u7684\u89C4\u5219\u63CF\u8FF0\uFF01",min:2}],children:(0,t.jsx)(k.Z,{placeholder:"\u8BF7\u8F93\u5165"})}),(0,t.jsx)(q,{labelCol:{span:5},wrapperCol:{span:15},label:"\u89D2\u8272\u540D\u79F0",name:"roleName",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u81F3\u5C11\u4E24\u4E2A\u5B57\u7B26\u7684\u89C4\u5219\u63CF\u8FF0\uFF01",min:2}],children:(0,t.jsx)(k.Z,{placeholder:"\u8BF7\u8F93\u5165"})}),(0,t.jsx)(q,{labelCol:{span:5},wrapperCol:{span:15},label:"\u63CF\u8FF0",name:"description",children:(0,t.jsx)(k.Z,{placeholder:"\u8BF7\u8F93\u5165"})})]})}),(0,t.jsx)(se.Z,{title:"\u914D\u7F6E\u8DEF\u7531",open:x,onOk:ft,onCancel:ct,centered:!0,forceRender:!0,getContainer:document.getElementById("root"),children:x&&fe[0]!=="first"&&ne[0]!=="first"&&(0,t.jsx)(Le,{allRoutes:Ue,curremtRoleRoutes:fe,num:0,newRouteIds:ne,handleNewRoutes:yt})})]})})},We=ze}}]);
